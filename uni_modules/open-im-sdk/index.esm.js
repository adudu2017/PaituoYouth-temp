var e,n,r=function(){function e(){this.events=void 0,this.events={}}var n=e.prototype;return n.emit=function(e,n){return this.events[e]&&this.events[e].forEach(function(e){return e(n)}),this},n.on=function(e,n){return this.events[e]?this.events[e].push(n):this.events[e]=[n],this},n.off=function(e,n){if(e&&"function"==typeof n){var r=this.events[e],t=r.findIndex(function(e){return e===n});r.splice(t,1)}else this.events[e]=[];return this},e}();function t(e,n){return t=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e},t(e,n)}!function(e){e.INITSDK="InitSDK",e.LOGIN="Login",e.LOGOUT="Logout",e.GETLOGINSTATUS="GetLoginStatus",e.GETLOGINUSER="GetLoginUser",e.GETSELFUSERINFO="GetSelfUserInfo",e.CREATETEXTMESSAGE="CreateTextMessage",e.CREATETEXTATMESSAGE="CreateTextAtMessage",e.CREATEIMAGEMESSAGEFROMBYURL="CreateImageMessageByURL",e.CREATESOUNDMESSAGEBYURL="CreateSoundMessageByURL",e.CREATEVIDEOMESSAGEBYURL="CreateVideoMessageByURL",e.CREATEFILEMESSAGEBYURL="CreateFileMessageByURL",e.CREATELOCATIONMESSAGE="CreateLocationMessage",e.CREATECUSTOMMESSAGE="CreateCustomMessage",e.CREATEMERGERMESSAGE="CreateMergerMessage",e.CREATEFORWARDMESSAGE="CreateForwardMessage",e.CREATEQUOTEMESSAGE="CreateQuoteMessage",e.CREATECARDMESSAGE="CreateCardMessage",e.SENDMESSAGE="SendMessage",e.SENDMESSAGENOTOSS="SendMessageNotOss",e.GETHISTORYMESSAGELIST="GetHistoryMessageList",e.REVOKEMESSAGE="RevokeMessage",e.DELETEMESSAGEFROMLOCALSTORAGE="DeleteMessageFromLocalStorage",e.MARKSINGLEMESSAGEHASREAD="MarkSingleMessageHasRead",e.INSERTSINGLEMESSAGETOLOCALSTORAGE="InsertSingleMessageToLocalStorage",e.INSERTGROUPMESSAGETOLOCALSTORAGE="InsertGroupMessageToLocalStorage",e.TYPINGSTATUSUPDATE="TypingStatusUpdate",e.MARKC2CMESSAGEASREAD="MarkC2CMessageAsRead",e.CLEARC2CHISTORYMESSAGE="ClearC2CHistoryMessage",e.CLEARGROUPHISTORYMESSAGE="ClearGroupHistoryMessage",e.ADDFRIEND="AddFriend",e.GETDESIGNATEDFRIENDSINFO="GetDesignatedFriendsInfo",e.GETRECVFRIENDAPPLICATIONLIST="GetRecvFriendApplicationList",e.GETSENDFRIENDAPPLICATIONLIST="GetSendFriendApplicationList",e.GETFRIENDLIST="GetFriendList",e.SETFRIENDREMARK="SetFriendRemark",e.ADDBLACK="AddBlack",e.GETBLACKLIST="GetBlackList",e.REMOVEBLACK="RemoveBlack",e.CHECKFRIEND="CheckFriend",e.ACCEPTFRIENDAPPLICATION="AcceptFriendApplication",e.REFUSEFRIENDAPPLICATION="RefuseFriendApplication",e.DELETEFRIEND="DeleteFriend",e.GETUSERSINFO="GetUsersInfo",e.SETSELFINFO="SetSelfInfo",e.GETALLCONVERSATIONLIST="GetAllConversationList",e.GETCONVERSATIONLISTSPLIT="GetConversationListSplit",e.GETONECONVERSATION="GetOneConversation",e.GETCONVERSATIONIDBYSESSIONTYPE="GetConversationIDBySessionType",e.GETMULTIPLECONVERSATION="GetMultipleConversation",e.DELETECONVERSATION="DeleteConversation",e.SETCONVERSATIONDRAFT="SetConversationDraft",e.PINCONVERSATION="PinConversation",e.GETTOTALUNREADMSGCOUNT="GetTotalUnreadMsgCount",e.GETCONVERSATIONRECVMESSAGEOPT="GetConversationRecvMessageOpt",e.SETCONVERSATIONRECVMESSAGEOPT="SetConversationRecvMessageOpt",e.SEARCHLOCALMESSAGES="SearchLocalMessages",e.MARKGROUPMESSAGEHASREAD="MarkGroupMessageHasRead",e.INVITEUSERTOGROUP="InviteUserToGroup",e.KICKGROUPMEMBER="KickGroupMember",e.GETGROUPMEMBERSINFO="GetGroupMembersInfo",e.GETGROUPMEMBERLIST="GetGroupMemberList",e.GETJOINEDGROUPLIST="GetJoinedGroupList",e.CREATEGROUP="CreateGroup",e.SETGROUPINFO="SetGroupInfo",e.GETGROUPSINFO="GetGroupsInfo",e.JOINGROUP="JoinGroup",e.QUITGROUP="QuitGroup",e.TRANSFERGROUPOWNER="TransferGroupOwner",e.GETSENDGROUPAPPLICATIONLIST="GetSendGroupApplicationList",e.GETRECVGROUPAPPLICATIONLIST="GetRecvGroupApplicationList",e.ACCEPTGROUPAPPLICATION="AcceptGroupApplication",e.REFUSEGROUPAPPLICATION="RefuseGroupApplication"}(e||(e={})),function(e){e.ONCONNECTFAILED="OnConnectFailed",e.ONCONNECTSUCCESS="OnConnectSuccess",e.ONCONNECTING="OnConnecting",e.ONKICKEDOFFLINE="OnKickedOffline",e.ONSELFINFOUPDATED="OnSelfInfoUpdated",e.ONUSERTOKENEXPIRED="OnUserTokenExpired",e.SENDMSGPROGRESS="OnProgress",e.ONRECVNEWMESSAGE="OnRecvNewMessage",e.ONRECVMESSAGEREVOKED="OnRecvMessageRevoked",e.ONRECVC2CREADRECEIPT="OnRecvC2CReadReceipt",e.ONCONVERSATIONCHANGED="OnConversationChanged",e.ONNEWCONVERSATION="OnNewConversation",e.ONSYNCSERVERFAILED="OnSyncServerFailed",e.ONSYNCSERVERFINISH="OnSyncServerFinish",e.ONSYNCSERVERSTART="OnSyncServerStart",e.ONTOTALUNREADMESSAGECOUNTCHANGED="OnTotalUnreadMessageCountChanged",e.ONBLACKADDED="OnBlackAdded",e.ONBLACKDELETED="OnBlackDeleted",e.ONFRIENDAPPLICATIONACCEPTED="OnFriendApplicationAccepted",e.ONFRIENDAPPLICATIONADDED="OnFriendApplicationAdded",e.ONRECEIVEFRIENDAPPLICATIONADDED="OnReceiveFriendApplicationAdded",e.ONRECEIVEFRIENDAPPLICATIONDELETED="OnReceiveFriendApplicationDeleted",e.ONFRIENDAPPLICATIONDELETED="OnFriendApplicationDeleted",e.ONFRIENDAPPLICATIONREJECTED="OnFriendApplicationRejected",e.ONFRIENDINFOCHANGED="OnFriendInfoChanged",e.ONFRIENDADDED="OnFriendAdded",e.ONFRIENDDELETED="OnFriendDeleted",e.ONJOINEDGROUPADDED="OnJoinedGroupAdded",e.ONJOINEDGROUPDELETED="OnJoinedGroupDeleted",e.ONGROUPMEMBERADDED="OnGroupMemberAdded",e.ONGROUPMEMBERDELETED="OnGroupMemberDeleted",e.ONRECEIVEJOINGROUPAPPLICATIONADDED="OnReceiveJoinGroupApplicationAdded",e.ONRECEIVEJOINGROUPAPPLICATIONDELETED="OnReceiveJoinGroupApplicationDeleted",e.ONGROUPAPPLICATIONADDED="OnGroupApplicationAdded",e.ONGROUPAPPLICATIONDELETED="OnGroupApplicationDeleted",e.ONGROUPINFOCHANGED="OnGroupInfoChanged",e.ONGROUPMEMBERINFOCHANGED="OnGroupMemberInfoChanged",e.ONGROUPAPPLICATIONACCEPTED="OnGroupApplicationAccepted",e.ONGROUPAPPLICATIONREJECTED="OnGroupApplicationRejected"}(n||(n={}));var i=function(e){return(36*Math.random()).toString(36).slice(2)+(new Date).getTime().toString()+e},o=function(r){var o,a;function u(){var t;return(t=r.call(this)||this).ws=void 0,t.uid=void 0,t.token=void 0,t.platform="web",t.wsUrl="",t.lock=!1,t.logoutFlag=!1,t.timer=void 0,t.ws2promise={},t.onceFlag=!0,t.getLoginStatus=function(n){return new Promise(function(r,o){var a=n||i(t.uid);t.wsSend({reqFuncName:e.GETLOGINSTATUS,operationID:a,userID:t.uid,data:""},r,o)})},t.getLoginUser=function(n){return new Promise(function(r,o){var a=n||i(t.uid);t.wsSend({reqFuncName:e.GETLOGINUSER,operationID:a,userID:t.uid,data:""},r,o)})},t.getSelfUserInfo=function(n){return new Promise(function(r,o){var a=n||i(t.uid);t.wsSend({reqFuncName:e.GETSELFUSERINFO,operationID:a,userID:t.uid,data:""},r,o)})},t.getUsersInfo=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.GETUSERSINFO,operationID:u,userID:t.uid,data:n},o,a)})},t.setSelfInfo=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.SETSELFINFO,operationID:u,userID:t.uid,data:n},o,a)})},t.createTextMessage=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.CREATETEXTMESSAGE,operationID:u,userID:t.uid,data:n},o,a)})},t.createTextAtMessage=function(n,r){return new Promise(function(o,a){var u=n;u.atUserIDList=JSON.stringify(u.atUserIDList);var s=r||i(t.uid);t.wsSend({reqFuncName:e.CREATETEXTATMESSAGE,operationID:s,userID:t.uid,data:u},o,a)})},t.createImageMessage=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid),s=n;s.bigPicture=JSON.stringify(s.bigPicture),s.snapshotPicture=JSON.stringify(s.snapshotPicture),s.sourcePicture=JSON.stringify(s.sourcePicture);var E={reqFuncName:e.CREATEIMAGEMESSAGEFROMBYURL,operationID:u,userID:t.uid,data:JSON.stringify(s)};t.wsSend(E,o,a)})},t.createSoundMessage=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid),s={soundBaseInfo:JSON.stringify(n)},E={reqFuncName:e.CREATESOUNDMESSAGEBYURL,operationID:u,userID:t.uid,data:JSON.stringify(s)};t.wsSend(E,o,a)})},t.createVideoMessage=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid),s={videoBaseInfo:JSON.stringify(n)},E={reqFuncName:e.CREATEVIDEOMESSAGEBYURL,operationID:u,userID:t.uid,data:JSON.stringify(s)};t.wsSend(E,o,a)})},t.createFileMessage=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid),s={fileBaseInfo:JSON.stringify(n)},E={reqFuncName:e.CREATEFILEMESSAGEBYURL,operationID:u,userID:t.uid,data:JSON.stringify(s)};t.wsSend(E,o,a)})},t.createMergerMessage=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid),s=n;s.messageList=JSON.stringify(n.messageList),s.summaryList=JSON.stringify(n.summaryList),t.wsSend({reqFuncName:e.CREATEMERGERMESSAGE,operationID:u,userID:t.uid,data:s},o,a)})},t.createForwardMessage=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.CREATEFORWARDMESSAGE,operationID:u,userID:t.uid,data:n},o,a)})},t.createLocationMessage=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.CREATELOCATIONMESSAGE,operationID:u,userID:t.uid,data:n},o,a)})},t.createCustomMessage=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.CREATECUSTOMMESSAGE,operationID:u,userID:t.uid,data:n},o,a)})},t.createQuoteMessage=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.CREATEQUOTEMESSAGE,operationID:u,userID:t.uid,data:n},o,a)})},t.createCardMessage=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.CREATECARDMESSAGE,operationID:u,userID:t.uid,data:n},o,a)})},t.sendMessage=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid),s=n;s.offlinePushInfo=s.offlinePushInfo?JSON.stringify(n.offlinePushInfo):"",t.wsSend({reqFuncName:e.SENDMESSAGE,operationID:u,userID:t.uid,data:s},o,a)})},t.sendMessageNotOss=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid),s=n;s.offlinePushInfo=s.offlinePushInfo?JSON.stringify(n.offlinePushInfo):"",t.wsSend({reqFuncName:e.SENDMESSAGENOTOSS,operationID:u,userID:t.uid,data:s},o,a)})},t.getHistoryMessageList=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.GETHISTORYMESSAGELIST,operationID:u,userID:t.uid,data:n},o,a)})},t.revokeMessage=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.REVOKEMESSAGE,operationID:u,userID:t.uid,data:n},o,a)})},t.deleteMessageFromLocalStorage=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.DELETEMESSAGEFROMLOCALSTORAGE,operationID:u,userID:t.uid,data:n},o,a)})},t.markSingleMessageHasRead=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.MARKSINGLEMESSAGEHASREAD,operationID:u,userID:t.uid,data:n},o,a)})},t.markGroupMessageHasRead=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.MARKGROUPMESSAGEHASREAD,operationID:u,userID:t.uid,data:n},o,a)})},t.insertSingleMessageToLocalStorage=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.INSERTSINGLEMESSAGETOLOCALSTORAGE,operationID:u,userID:t.uid,data:n},o,a)})},t.insertGroupMessageToLocalStorage=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.INSERTGROUPMESSAGETOLOCALSTORAGE,operationID:u,userID:t.uid,data:n},o,a)})},t.typingStatusUpdate=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.TYPINGSTATUSUPDATE,operationID:u,userID:t.uid,data:n},o,a)})},t.markC2CMessageAsRead=function(n,r){return new Promise(function(o,a){var u=n;u.msgIDList=JSON.stringify(u.msgIDList);var s=r||i(t.uid);t.wsSend({reqFuncName:e.MARKC2CMESSAGEASREAD,operationID:s,userID:t.uid,data:u},o,a)})},t.clearC2CHistoryMessage=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.CLEARC2CHISTORYMESSAGE,operationID:u,userID:t.uid,data:n},o,a)})},t.clearGroupHistoryMessage=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.CLEARGROUPHISTORYMESSAGE,operationID:u,userID:t.uid,data:n},o,a)})},t.getAllConversationList=function(n){return new Promise(function(r,o){var a=n||i(t.uid);t.wsSend({reqFuncName:e.GETALLCONVERSATIONLIST,operationID:a,userID:t.uid,data:""},r,o)})},t.getConversationListSplit=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.GETCONVERSATIONLISTSPLIT,operationID:u,userID:t.uid,data:n},o,a)})},t.getOneConversation=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.GETONECONVERSATION,operationID:u,userID:t.uid,data:n},o,a)})},t.getConversationIDBySessionType=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.GETCONVERSATIONIDBYSESSIONTYPE,operationID:u,userID:t.uid,data:n},o,a)})},t.getMultipleConversation=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.GETMULTIPLECONVERSATION,operationID:u,userID:t.uid,data:n},o,a)})},t.deleteConversation=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.DELETECONVERSATION,operationID:u,userID:t.uid,data:n},o,a)})},t.setConversationDraft=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.SETCONVERSATIONDRAFT,operationID:u,userID:t.uid,data:n},o,a)})},t.pinConversation=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.PINCONVERSATION,operationID:u,userID:t.uid,data:n},o,a)})},t.getTotalUnreadMsgCount=function(n){return new Promise(function(r,o){var a=n||i(t.uid);t.wsSend({reqFuncName:e.GETTOTALUNREADMSGCOUNT,operationID:a,userID:t.uid,data:""},r,o)})},t.getConversationRecvMessageOpt=function(n,r){return new Promise(function(n,o){var a=r||i(t.uid);t.wsSend({reqFuncName:e.GETCONVERSATIONRECVMESSAGEOPT,operationID:a,userID:t.uid,data:""},n,o)})},t.setConversationRecvMessageOpt=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid),s=n;s.conversationIDList=JSON.stringify(n.conversationIDList),t.wsSend({reqFuncName:e.SETCONVERSATIONRECVMESSAGEOPT,operationID:u,userID:t.uid,data:s},o,a)})},t.searchLocalMessages=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.SEARCHLOCALMESSAGES,operationID:u,userID:t.uid,data:n},o,a)})},t.addFriend=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.ADDFRIEND,operationID:u,userID:t.uid,data:n},o,a)})},t.getDesignatedFriendsInfo=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.GETDESIGNATEDFRIENDSINFO,operationID:u,userID:t.uid,data:n},o,a)})},t.getRecvFriendApplicationList=function(n){return new Promise(function(r,o){var a=n||i(t.uid);t.wsSend({reqFuncName:e.GETRECVFRIENDAPPLICATIONLIST,operationID:a,userID:t.uid,data:""},r,o)})},t.getSendFriendApplicationList=function(n){return new Promise(function(r,o){var a=n||i(t.uid);t.wsSend({reqFuncName:e.GETSENDFRIENDAPPLICATIONLIST,operationID:a,userID:t.uid,data:""},r,o)})},t.getFriendList=function(n){return new Promise(function(r,o){var a=n||i(t.uid);t.wsSend({reqFuncName:e.GETFRIENDLIST,operationID:a,userID:t.uid,data:""},r,o)})},t.setFriendRemark=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.SETFRIENDREMARK,operationID:u,userID:t.uid,data:n},o,a)})},t.checkFriend=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.CHECKFRIEND,operationID:u,userID:t.uid,data:n},o,a)})},t.acceptFriendApplication=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.ACCEPTFRIENDAPPLICATION,operationID:u,userID:t.uid,data:n},o,a)})},t.refuseFriendApplication=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.REFUSEFRIENDAPPLICATION,operationID:u,userID:t.uid,data:n},o,a)})},t.deleteFriend=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.DELETEFRIEND,operationID:u,userID:t.uid,data:n},o,a)})},t.addBlack=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.ADDBLACK,operationID:u,userID:t.uid,data:n},o,a)})},t.removeBlack=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.REMOVEBLACK,operationID:u,userID:t.uid,data:n},o,a)})},t.getBlackList=function(n){return new Promise(function(r,o){var a=n||i(t.uid);t.wsSend({reqFuncName:e.GETBLACKLIST,operationID:a,userID:t.uid,data:""},r,o)})},t.inviteUserToGroup=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid),s=n;s.userIDList=JSON.stringify(s.userIDList),t.wsSend({reqFuncName:e.INVITEUSERTOGROUP,operationID:u,userID:t.uid,data:s},o,a)})},t.kickGroupMember=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid),s=n;s.userIDList=JSON.stringify(s.userIDList),t.wsSend({reqFuncName:e.KICKGROUPMEMBER,operationID:u,userID:t.uid,data:s},o,a)})},t.getGroupMembersInfo=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid),s=n;s.userIDList=JSON.stringify(s.userIDList),t.wsSend({reqFuncName:e.GETGROUPMEMBERSINFO,operationID:u,userID:t.uid,data:s},o,a)})},t.getGroupMemberList=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.GETGROUPMEMBERLIST,operationID:u,userID:t.uid,data:n},o,a)})},t.getJoinedGroupList=function(n){return new Promise(function(r,o){var a=n||i(t.uid);t.wsSend({reqFuncName:e.GETJOINEDGROUPLIST,operationID:a,userID:t.uid,data:""},r,o)})},t.createGroup=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid),s=n;s.groupBaseInfo=JSON.stringify(s.groupBaseInfo),s.memberList=JSON.stringify(s.memberList),t.wsSend({reqFuncName:e.CREATEGROUP,operationID:u,userID:t.uid,data:s},o,a)})},t.setGroupInfo=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid),s=n;s.groupInfo=JSON.stringify(s.groupInfo),t.wsSend({reqFuncName:e.SETGROUPINFO,operationID:u,userID:t.uid,data:s},o,a)})},t.getGroupsInfo=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.GETGROUPSINFO,operationID:u,userID:t.uid,data:n},o,a)})},t.joinGroup=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.JOINGROUP,operationID:u,userID:t.uid,data:n},o,a)})},t.quitGroup=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.QUITGROUP,operationID:u,userID:t.uid,data:n},o,a)})},t.transferGroupOwner=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.TRANSFERGROUPOWNER,operationID:u,userID:t.uid,data:n},o,a)})},t.getSendGroupApplicationList=function(n){return new Promise(function(r,o){var a=n||i(t.uid);t.wsSend({reqFuncName:e.GETSENDGROUPAPPLICATIONLIST,operationID:a,userID:t.uid,data:""},r,o)})},t.getRecvGroupApplicationList=function(n){return new Promise(function(r,o){var a=n||i(t.uid);t.wsSend({reqFuncName:e.GETRECVGROUPAPPLICATIONLIST,operationID:a,userID:t.uid,data:""},r,o)})},t.acceptGroupApplication=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.ACCEPTGROUPAPPLICATION,operationID:u,userID:t.uid,data:n},o,a)})},t.refuseGroupApplication=function(n,r){return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.REFUSEGROUPAPPLICATION,operationID:u,userID:t.uid,data:n},o,a)})},t.wsSend=function(r,o,a){void 0===t.ws&&a({event:r.reqFuncName,errCode:112,errMsg:"ws conect failed...",data:"",operationID:r.operationID||""}),"object"==typeof r.data&&(r.data=JSON.stringify(r.data));var u={oid:r.operationID||i(t.uid),mname:r.reqFuncName,mrsve:o,mrjet:a,flag:!1};t.ws2promise[u.oid]=u;var s=function(i){var o=JSON.parse(i.data);n[o.event.toUpperCase()]&&t.emit(o.event,o),r.reqFuncName===e.LOGOUT&&(t.logoutFlag=!0,t.ws.close(),t.ws=void 0);var a=t.ws2promise[o.operationID];a&&(0===o.errCode?a.mrsve(o):a.mrjet(o),delete t.ws2promise[o.operationID])};"web"==t.platform?(t.ws.send(JSON.stringify(r)),t.onceFlag&&(t.ws.onmessage=s,t.onceFlag=!1)):(t.ws.send({data:JSON.stringify(r),success:function(e){"uni"===t.platform&&void 0!==t.ws._callbacks&&void 0!==t.ws._callbacks.message&&(t.ws._callbacks.message=[])}}),t.onceFlag&&(t.ws.onMessage(s),t.onceFlag=!1)),r.reqFuncName===e.LOGOUT&&(t.onceFlag=!0)},t.getPlatform(),t}a=r,(o=u).prototype=Object.create(a.prototype),o.prototype.constructor=o,t(o,a);var s=u.prototype;return s.login=function(n){var r=this;return new Promise(function(t,i){var o=n.userID,a=n.token,u=n.operationID;r.wsUrl=n.url+"?sendID="+o+"&token="+a+"&platformID="+n.platformID;var s={userID:o,token:a},E={event:e.LOGIN,errCode:0,errMsg:"",data:"",operationID:u||""};r.createWs(function(){r.uid=o,r.token=a,r.iLogin(s,u).then(function(e){r.logoutFlag=!1,t(e)}).catch(function(e){E.errCode=e.errCode,E.errMsg=e.errMsg,i(E)})},function(){},function(e){console.log(e),E.errCode=111,E.errMsg="ws connect failed...",r.logoutFlag||r.reconnect(),i(E)}),r.ws||(E.errCode=112,E.errMsg="The current platform is not supported...",i(E))})},s.iLogin=function(n,r){var t=this;return new Promise(function(o,a){var u=r||i(t.uid);t.wsSend({reqFuncName:e.LOGIN,operationID:u,userID:t.uid,data:n},o,a)})},s.logout=function(n){var r=this;return new Promise(function(t,o){var a=n||i(r.uid);r.wsSend({reqFuncName:e.LOGOUT,operationID:a,userID:r.uid,data:""},t,o)})},s.getPlatform=function(){var e=typeof WebSocket,n=typeof uni,r=typeof wx;this.platform="undefined"===e?"object"===n&&"object"!==r?"uni":"object"!==n&&"object"===r?"wx":"unknow":"web"},s.createWs=function(e,n,r){var t=this,i=function(){t.iLogin({userID:t.uid,token:t.token}).then(function(e){return t.logoutFlag=!1})};e&&(i=e);var o=function(){console.log("ws close agin:::"),t.logoutFlag||t.reconnect()};n&&(o=n);var a=function(){};if(r&&(a=r),"web"===this.platform)return this.ws=new WebSocket(this.wsUrl),this.ws.onclose=o,this.ws.onopen=i,void(this.ws.onerror=a);var u="uni"===this.platform?uni:wx;this.ws=u.connectSocket({url:this.wsUrl,complete:function(){}}),this.ws.onClose(o),this.ws.onOpen(i),this.ws.onError(a)},s.reconnect=function(){var e=this;this.lock||(this.lock=!0,setTimeout(function(){e.createWs(),e.lock=!1},2e3))},u}(r);export{n as CbEvents,o as OpenIMSDK,e as RequestFunc,r as emitter,i as uuid};
//# sourceMappingURL=index.esm.js.map
