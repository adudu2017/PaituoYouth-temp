!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e||self).openImSdk={})}(this,function(e){var n,t,r=function(){function e(){this.events=void 0,this.events={}}var n=e.prototype;return n.emit=function(e,n){return this.events[e]&&this.events[e].forEach(function(e){return e(n)}),this},n.on=function(e,n){return this.events[e]?this.events[e].push(n):this.events[e]=[n],this},n.off=function(e,n){if(e&&"function"==typeof n){var t=this.events[e],r=t.findIndex(function(e){return e===n});t.splice(r,1)}else this.events[e]=[];return this},e}();function i(e,n){return i=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e},i(e,n)}e.RequestFunc=void 0,(n=e.RequestFunc||(e.RequestFunc={})).INITSDK="InitSDK",n.LOGIN="Login",n.LOGOUT="Logout",n.GETLOGINSTATUS="GetLoginStatus",n.GETLOGINUSER="GetLoginUser",n.GETSELFUSERINFO="GetSelfUserInfo",n.CREATETEXTMESSAGE="CreateTextMessage",n.CREATETEXTATMESSAGE="CreateTextAtMessage",n.CREATEIMAGEMESSAGEFROMBYURL="CreateImageMessageByURL",n.CREATESOUNDMESSAGEBYURL="CreateSoundMessageByURL",n.CREATEVIDEOMESSAGEBYURL="CreateVideoMessageByURL",n.CREATEFILEMESSAGEBYURL="CreateFileMessageByURL",n.CREATELOCATIONMESSAGE="CreateLocationMessage",n.CREATECUSTOMMESSAGE="CreateCustomMessage",n.CREATEMERGERMESSAGE="CreateMergerMessage",n.CREATEFORWARDMESSAGE="CreateForwardMessage",n.CREATEQUOTEMESSAGE="CreateQuoteMessage",n.CREATECARDMESSAGE="CreateCardMessage",n.SENDMESSAGE="SendMessage",n.SENDMESSAGENOTOSS="SendMessageNotOss",n.GETHISTORYMESSAGELIST="GetHistoryMessageList",n.REVOKEMESSAGE="RevokeMessage",n.DELETEMESSAGEFROMLOCALSTORAGE="DeleteMessageFromLocalStorage",n.MARKSINGLEMESSAGEHASREAD="MarkSingleMessageHasRead",n.INSERTSINGLEMESSAGETOLOCALSTORAGE="InsertSingleMessageToLocalStorage",n.INSERTGROUPMESSAGETOLOCALSTORAGE="InsertGroupMessageToLocalStorage",n.TYPINGSTATUSUPDATE="TypingStatusUpdate",n.MARKC2CMESSAGEASREAD="MarkC2CMessageAsRead",n.CLEARC2CHISTORYMESSAGE="ClearC2CHistoryMessage",n.CLEARGROUPHISTORYMESSAGE="ClearGroupHistoryMessage",n.ADDFRIEND="AddFriend",n.GETDESIGNATEDFRIENDSINFO="GetDesignatedFriendsInfo",n.GETRECVFRIENDAPPLICATIONLIST="GetRecvFriendApplicationList",n.GETSENDFRIENDAPPLICATIONLIST="GetSendFriendApplicationList",n.GETFRIENDLIST="GetFriendList",n.SETFRIENDREMARK="SetFriendRemark",n.ADDBLACK="AddBlack",n.GETBLACKLIST="GetBlackList",n.REMOVEBLACK="RemoveBlack",n.CHECKFRIEND="CheckFriend",n.ACCEPTFRIENDAPPLICATION="AcceptFriendApplication",n.REFUSEFRIENDAPPLICATION="RefuseFriendApplication",n.DELETEFRIEND="DeleteFriend",n.GETUSERSINFO="GetUsersInfo",n.SETSELFINFO="SetSelfInfo",n.GETALLCONVERSATIONLIST="GetAllConversationList",n.GETCONVERSATIONLISTSPLIT="GetConversationListSplit",n.GETONECONVERSATION="GetOneConversation",n.GETCONVERSATIONIDBYSESSIONTYPE="GetConversationIDBySessionType",n.GETMULTIPLECONVERSATION="GetMultipleConversation",n.DELETECONVERSATION="DeleteConversation",n.SETCONVERSATIONDRAFT="SetConversationDraft",n.PINCONVERSATION="PinConversation",n.GETTOTALUNREADMSGCOUNT="GetTotalUnreadMsgCount",n.GETCONVERSATIONRECVMESSAGEOPT="GetConversationRecvMessageOpt",n.SETCONVERSATIONRECVMESSAGEOPT="SetConversationRecvMessageOpt",n.SEARCHLOCALMESSAGES="SearchLocalMessages",n.MARKGROUPMESSAGEHASREAD="MarkGroupMessageHasRead",n.INVITEUSERTOGROUP="InviteUserToGroup",n.KICKGROUPMEMBER="KickGroupMember",n.GETGROUPMEMBERSINFO="GetGroupMembersInfo",n.GETGROUPMEMBERLIST="GetGroupMemberList",n.GETJOINEDGROUPLIST="GetJoinedGroupList",n.CREATEGROUP="CreateGroup",n.SETGROUPINFO="SetGroupInfo",n.GETGROUPSINFO="GetGroupsInfo",n.JOINGROUP="JoinGroup",n.QUITGROUP="QuitGroup",n.TRANSFERGROUPOWNER="TransferGroupOwner",n.GETSENDGROUPAPPLICATIONLIST="GetSendGroupApplicationList",n.GETRECVGROUPAPPLICATIONLIST="GetRecvGroupApplicationList",n.ACCEPTGROUPAPPLICATION="AcceptGroupApplication",n.REFUSEGROUPAPPLICATION="RefuseGroupApplication",e.CbEvents=void 0,(t=e.CbEvents||(e.CbEvents={})).ONCONNECTFAILED="OnConnectFailed",t.ONCONNECTSUCCESS="OnConnectSuccess",t.ONCONNECTING="OnConnecting",t.ONKICKEDOFFLINE="OnKickedOffline",t.ONSELFINFOUPDATED="OnSelfInfoUpdated",t.ONUSERTOKENEXPIRED="OnUserTokenExpired",t.SENDMSGPROGRESS="OnProgress",t.ONRECVNEWMESSAGE="OnRecvNewMessage",t.ONRECVMESSAGEREVOKED="OnRecvMessageRevoked",t.ONRECVC2CREADRECEIPT="OnRecvC2CReadReceipt",t.ONCONVERSATIONCHANGED="OnConversationChanged",t.ONNEWCONVERSATION="OnNewConversation",t.ONSYNCSERVERFAILED="OnSyncServerFailed",t.ONSYNCSERVERFINISH="OnSyncServerFinish",t.ONSYNCSERVERSTART="OnSyncServerStart",t.ONTOTALUNREADMESSAGECOUNTCHANGED="OnTotalUnreadMessageCountChanged",t.ONBLACKADDED="OnBlackAdded",t.ONBLACKDELETED="OnBlackDeleted",t.ONFRIENDAPPLICATIONACCEPTED="OnFriendApplicationAccepted",t.ONFRIENDAPPLICATIONADDED="OnFriendApplicationAdded",t.ONRECEIVEFRIENDAPPLICATIONADDED="OnReceiveFriendApplicationAdded",t.ONRECEIVEFRIENDAPPLICATIONDELETED="OnReceiveFriendApplicationDeleted",t.ONFRIENDAPPLICATIONDELETED="OnFriendApplicationDeleted",t.ONFRIENDAPPLICATIONREJECTED="OnFriendApplicationRejected",t.ONFRIENDINFOCHANGED="OnFriendInfoChanged",t.ONFRIENDADDED="OnFriendAdded",t.ONFRIENDDELETED="OnFriendDeleted",t.ONJOINEDGROUPADDED="OnJoinedGroupAdded",t.ONJOINEDGROUPDELETED="OnJoinedGroupDeleted",t.ONGROUPMEMBERADDED="OnGroupMemberAdded",t.ONGROUPMEMBERDELETED="OnGroupMemberDeleted",t.ONRECEIVEJOINGROUPAPPLICATIONADDED="OnReceiveJoinGroupApplicationAdded",t.ONRECEIVEJOINGROUPAPPLICATIONDELETED="OnReceiveJoinGroupApplicationDeleted",t.ONGROUPAPPLICATIONADDED="OnGroupApplicationAdded",t.ONGROUPAPPLICATIONDELETED="OnGroupApplicationDeleted",t.ONGROUPINFOCHANGED="OnGroupInfoChanged",t.ONGROUPMEMBERINFOCHANGED="OnGroupMemberInfoChanged",t.ONGROUPAPPLICATIONACCEPTED="OnGroupApplicationAccepted",t.ONGROUPAPPLICATIONREJECTED="OnGroupApplicationRejected";var u=function(e){return(36*Math.random()).toString(36).slice(2)+(new Date).getTime().toString()+e};e.OpenIMSDK=function(n){var t,r;function o(){var t;return(t=n.call(this)||this).ws=void 0,t.uid=void 0,t.token=void 0,t.platform="web",t.wsUrl="",t.lock=!1,t.logoutFlag=!1,t.timer=void 0,t.ws2promise={},t.onceFlag=!0,t.getLoginStatus=function(n){return new Promise(function(r,i){var o=n||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.GETLOGINSTATUS,operationID:o,userID:t.uid,data:""},r,i)})},t.getLoginUser=function(n){return new Promise(function(r,i){var o=n||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.GETLOGINUSER,operationID:o,userID:t.uid,data:""},r,i)})},t.getSelfUserInfo=function(n){return new Promise(function(r,i){var o=n||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.GETSELFUSERINFO,operationID:o,userID:t.uid,data:""},r,i)})},t.getUsersInfo=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.GETUSERSINFO,operationID:s,userID:t.uid,data:n},i,o)})},t.setSelfInfo=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.SETSELFINFO,operationID:s,userID:t.uid,data:n},i,o)})},t.createTextMessage=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.CREATETEXTMESSAGE,operationID:s,userID:t.uid,data:n},i,o)})},t.createTextAtMessage=function(n,r){return new Promise(function(i,o){var s=n;s.atUserIDList=JSON.stringify(s.atUserIDList);var a=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.CREATETEXTATMESSAGE,operationID:a,userID:t.uid,data:s},i,o)})},t.createImageMessage=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid),a=n;a.bigPicture=JSON.stringify(a.bigPicture),a.snapshotPicture=JSON.stringify(a.snapshotPicture),a.sourcePicture=JSON.stringify(a.sourcePicture);var E={reqFuncName:e.RequestFunc.CREATEIMAGEMESSAGEFROMBYURL,operationID:s,userID:t.uid,data:JSON.stringify(a)};t.wsSend(E,i,o)})},t.createSoundMessage=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid),a={soundBaseInfo:JSON.stringify(n)},E={reqFuncName:e.RequestFunc.CREATESOUNDMESSAGEBYURL,operationID:s,userID:t.uid,data:JSON.stringify(a)};t.wsSend(E,i,o)})},t.createVideoMessage=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid),a={videoBaseInfo:JSON.stringify(n)},E={reqFuncName:e.RequestFunc.CREATEVIDEOMESSAGEBYURL,operationID:s,userID:t.uid,data:JSON.stringify(a)};t.wsSend(E,i,o)})},t.createFileMessage=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid),a={fileBaseInfo:JSON.stringify(n)},E={reqFuncName:e.RequestFunc.CREATEFILEMESSAGEBYURL,operationID:s,userID:t.uid,data:JSON.stringify(a)};t.wsSend(E,i,o)})},t.createMergerMessage=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid),a=n;a.messageList=JSON.stringify(n.messageList),a.summaryList=JSON.stringify(n.summaryList),t.wsSend({reqFuncName:e.RequestFunc.CREATEMERGERMESSAGE,operationID:s,userID:t.uid,data:a},i,o)})},t.createForwardMessage=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.CREATEFORWARDMESSAGE,operationID:s,userID:t.uid,data:n},i,o)})},t.createLocationMessage=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.CREATELOCATIONMESSAGE,operationID:s,userID:t.uid,data:n},i,o)})},t.createCustomMessage=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.CREATECUSTOMMESSAGE,operationID:s,userID:t.uid,data:n},i,o)})},t.createQuoteMessage=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.CREATEQUOTEMESSAGE,operationID:s,userID:t.uid,data:n},i,o)})},t.createCardMessage=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.CREATECARDMESSAGE,operationID:s,userID:t.uid,data:n},i,o)})},t.sendMessage=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid),a=n;a.offlinePushInfo=a.offlinePushInfo?JSON.stringify(n.offlinePushInfo):"",t.wsSend({reqFuncName:e.RequestFunc.SENDMESSAGE,operationID:s,userID:t.uid,data:a},i,o)})},t.sendMessageNotOss=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid),a=n;a.offlinePushInfo=a.offlinePushInfo?JSON.stringify(n.offlinePushInfo):"",t.wsSend({reqFuncName:e.RequestFunc.SENDMESSAGENOTOSS,operationID:s,userID:t.uid,data:a},i,o)})},t.getHistoryMessageList=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.GETHISTORYMESSAGELIST,operationID:s,userID:t.uid,data:n},i,o)})},t.revokeMessage=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.REVOKEMESSAGE,operationID:s,userID:t.uid,data:n},i,o)})},t.deleteMessageFromLocalStorage=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.DELETEMESSAGEFROMLOCALSTORAGE,operationID:s,userID:t.uid,data:n},i,o)})},t.markSingleMessageHasRead=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.MARKSINGLEMESSAGEHASREAD,operationID:s,userID:t.uid,data:n},i,o)})},t.markGroupMessageHasRead=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.MARKGROUPMESSAGEHASREAD,operationID:s,userID:t.uid,data:n},i,o)})},t.insertSingleMessageToLocalStorage=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.INSERTSINGLEMESSAGETOLOCALSTORAGE,operationID:s,userID:t.uid,data:n},i,o)})},t.insertGroupMessageToLocalStorage=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.INSERTGROUPMESSAGETOLOCALSTORAGE,operationID:s,userID:t.uid,data:n},i,o)})},t.typingStatusUpdate=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.TYPINGSTATUSUPDATE,operationID:s,userID:t.uid,data:n},i,o)})},t.markC2CMessageAsRead=function(n,r){return new Promise(function(i,o){var s=n;s.msgIDList=JSON.stringify(s.msgIDList);var a=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.MARKC2CMESSAGEASREAD,operationID:a,userID:t.uid,data:s},i,o)})},t.clearC2CHistoryMessage=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.CLEARC2CHISTORYMESSAGE,operationID:s,userID:t.uid,data:n},i,o)})},t.clearGroupHistoryMessage=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.CLEARGROUPHISTORYMESSAGE,operationID:s,userID:t.uid,data:n},i,o)})},t.getAllConversationList=function(n){return new Promise(function(r,i){var o=n||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.GETALLCONVERSATIONLIST,operationID:o,userID:t.uid,data:""},r,i)})},t.getConversationListSplit=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.GETCONVERSATIONLISTSPLIT,operationID:s,userID:t.uid,data:n},i,o)})},t.getOneConversation=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.GETONECONVERSATION,operationID:s,userID:t.uid,data:n},i,o)})},t.getConversationIDBySessionType=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.GETCONVERSATIONIDBYSESSIONTYPE,operationID:s,userID:t.uid,data:n},i,o)})},t.getMultipleConversation=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.GETMULTIPLECONVERSATION,operationID:s,userID:t.uid,data:n},i,o)})},t.deleteConversation=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.DELETECONVERSATION,operationID:s,userID:t.uid,data:n},i,o)})},t.setConversationDraft=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.SETCONVERSATIONDRAFT,operationID:s,userID:t.uid,data:n},i,o)})},t.pinConversation=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.PINCONVERSATION,operationID:s,userID:t.uid,data:n},i,o)})},t.getTotalUnreadMsgCount=function(n){return new Promise(function(r,i){var o=n||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.GETTOTALUNREADMSGCOUNT,operationID:o,userID:t.uid,data:""},r,i)})},t.getConversationRecvMessageOpt=function(n,r){return new Promise(function(n,i){var o=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.GETCONVERSATIONRECVMESSAGEOPT,operationID:o,userID:t.uid,data:""},n,i)})},t.setConversationRecvMessageOpt=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid),a=n;a.conversationIDList=JSON.stringify(n.conversationIDList),t.wsSend({reqFuncName:e.RequestFunc.SETCONVERSATIONRECVMESSAGEOPT,operationID:s,userID:t.uid,data:a},i,o)})},t.searchLocalMessages=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.SEARCHLOCALMESSAGES,operationID:s,userID:t.uid,data:n},i,o)})},t.addFriend=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.ADDFRIEND,operationID:s,userID:t.uid,data:n},i,o)})},t.getDesignatedFriendsInfo=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.GETDESIGNATEDFRIENDSINFO,operationID:s,userID:t.uid,data:n},i,o)})},t.getRecvFriendApplicationList=function(n){return new Promise(function(r,i){var o=n||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.GETRECVFRIENDAPPLICATIONLIST,operationID:o,userID:t.uid,data:""},r,i)})},t.getSendFriendApplicationList=function(n){return new Promise(function(r,i){var o=n||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.GETSENDFRIENDAPPLICATIONLIST,operationID:o,userID:t.uid,data:""},r,i)})},t.getFriendList=function(n){return new Promise(function(r,i){var o=n||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.GETFRIENDLIST,operationID:o,userID:t.uid,data:""},r,i)})},t.setFriendRemark=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.SETFRIENDREMARK,operationID:s,userID:t.uid,data:n},i,o)})},t.checkFriend=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.CHECKFRIEND,operationID:s,userID:t.uid,data:n},i,o)})},t.acceptFriendApplication=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.ACCEPTFRIENDAPPLICATION,operationID:s,userID:t.uid,data:n},i,o)})},t.refuseFriendApplication=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.REFUSEFRIENDAPPLICATION,operationID:s,userID:t.uid,data:n},i,o)})},t.deleteFriend=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.DELETEFRIEND,operationID:s,userID:t.uid,data:n},i,o)})},t.addBlack=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.ADDBLACK,operationID:s,userID:t.uid,data:n},i,o)})},t.removeBlack=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.REMOVEBLACK,operationID:s,userID:t.uid,data:n},i,o)})},t.getBlackList=function(n){return new Promise(function(r,i){var o=n||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.GETBLACKLIST,operationID:o,userID:t.uid,data:""},r,i)})},t.inviteUserToGroup=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid),a=n;a.userIDList=JSON.stringify(a.userIDList),t.wsSend({reqFuncName:e.RequestFunc.INVITEUSERTOGROUP,operationID:s,userID:t.uid,data:a},i,o)})},t.kickGroupMember=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid),a=n;a.userIDList=JSON.stringify(a.userIDList),t.wsSend({reqFuncName:e.RequestFunc.KICKGROUPMEMBER,operationID:s,userID:t.uid,data:a},i,o)})},t.getGroupMembersInfo=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid),a=n;a.userIDList=JSON.stringify(a.userIDList),t.wsSend({reqFuncName:e.RequestFunc.GETGROUPMEMBERSINFO,operationID:s,userID:t.uid,data:a},i,o)})},t.getGroupMemberList=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.GETGROUPMEMBERLIST,operationID:s,userID:t.uid,data:n},i,o)})},t.getJoinedGroupList=function(n){return new Promise(function(r,i){var o=n||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.GETJOINEDGROUPLIST,operationID:o,userID:t.uid,data:""},r,i)})},t.createGroup=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid),a=n;a.groupBaseInfo=JSON.stringify(a.groupBaseInfo),a.memberList=JSON.stringify(a.memberList),t.wsSend({reqFuncName:e.RequestFunc.CREATEGROUP,operationID:s,userID:t.uid,data:a},i,o)})},t.setGroupInfo=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid),a=n;a.groupInfo=JSON.stringify(a.groupInfo),t.wsSend({reqFuncName:e.RequestFunc.SETGROUPINFO,operationID:s,userID:t.uid,data:a},i,o)})},t.getGroupsInfo=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.GETGROUPSINFO,operationID:s,userID:t.uid,data:n},i,o)})},t.joinGroup=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.JOINGROUP,operationID:s,userID:t.uid,data:n},i,o)})},t.quitGroup=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.QUITGROUP,operationID:s,userID:t.uid,data:n},i,o)})},t.transferGroupOwner=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.TRANSFERGROUPOWNER,operationID:s,userID:t.uid,data:n},i,o)})},t.getSendGroupApplicationList=function(n){return new Promise(function(r,i){var o=n||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.GETSENDGROUPAPPLICATIONLIST,operationID:o,userID:t.uid,data:""},r,i)})},t.getRecvGroupApplicationList=function(n){return new Promise(function(r,i){var o=n||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.GETRECVGROUPAPPLICATIONLIST,operationID:o,userID:t.uid,data:""},r,i)})},t.acceptGroupApplication=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.ACCEPTGROUPAPPLICATION,operationID:s,userID:t.uid,data:n},i,o)})},t.refuseGroupApplication=function(n,r){return new Promise(function(i,o){var s=r||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.REFUSEGROUPAPPLICATION,operationID:s,userID:t.uid,data:n},i,o)})},t.wsSend=function(n,r,i){void 0===t.ws&&i({event:n.reqFuncName,errCode:112,errMsg:"ws conect failed...",data:"",operationID:n.operationID||""}),"object"==typeof n.data&&(n.data=JSON.stringify(n.data));var o={oid:n.operationID||u(t.uid),mname:n.reqFuncName,mrsve:r,mrjet:i,flag:!1};t.ws2promise[o.oid]=o;var s=function(r){var i=JSON.parse(r.data);e.CbEvents[i.event.toUpperCase()]&&t.emit(i.event,i),n.reqFuncName===e.RequestFunc.LOGOUT&&(t.logoutFlag=!0,t.ws.close(),t.ws=void 0);var u=t.ws2promise[i.operationID];u&&(0===i.errCode?u.mrsve(i):u.mrjet(i),delete t.ws2promise[i.operationID])};"web"==t.platform?(t.ws.send(JSON.stringify(n)),t.onceFlag&&(t.ws.onmessage=s,t.onceFlag=!1)):(t.ws.send({data:JSON.stringify(n),success:function(e){"uni"===t.platform&&void 0!==t.ws._callbacks&&void 0!==t.ws._callbacks.message&&(t.ws._callbacks.message=[])}}),t.onceFlag&&(t.ws.onMessage(s),t.onceFlag=!1)),n.reqFuncName===e.RequestFunc.LOGOUT&&(t.onceFlag=!0)},t.getPlatform(),t}r=n,(t=o).prototype=Object.create(r.prototype),t.prototype.constructor=t,i(t,r);var s=o.prototype;return s.login=function(n){var t=this;return new Promise(function(r,i){var u=n.userID,o=n.token,s=n.operationID;t.wsUrl=n.url+"?sendID="+u+"&token="+o+"&platformID="+n.platformID;var a={userID:u,token:o},E={event:e.RequestFunc.LOGIN,errCode:0,errMsg:"",data:"",operationID:s||""};t.createWs(function(){t.uid=u,t.token=o,t.iLogin(a,s).then(function(e){t.logoutFlag=!1,r(e)}).catch(function(e){E.errCode=e.errCode,E.errMsg=e.errMsg,i(E)})},function(){},function(e){console.log(e),E.errCode=111,E.errMsg="ws connect failed...",t.logoutFlag||t.reconnect(),i(E)}),t.ws||(E.errCode=112,E.errMsg="The current platform is not supported...",i(E))})},s.iLogin=function(n,t){var r=this;return new Promise(function(i,o){var s=t||u(r.uid);r.wsSend({reqFuncName:e.RequestFunc.LOGIN,operationID:s,userID:r.uid,data:n},i,o)})},s.logout=function(n){var t=this;return new Promise(function(r,i){var o=n||u(t.uid);t.wsSend({reqFuncName:e.RequestFunc.LOGOUT,operationID:o,userID:t.uid,data:""},r,i)})},s.getPlatform=function(){var e=typeof WebSocket,n=typeof uni,t=typeof wx;this.platform="undefined"===e?"object"===n&&"object"!==t?"uni":"object"!==n&&"object"===t?"wx":"unknow":"web"},s.createWs=function(e,n,t){var r=this,i=function(){r.iLogin({userID:r.uid,token:r.token}).then(function(e){return r.logoutFlag=!1})};e&&(i=e);var u=function(){console.log("ws close agin:::"),r.logoutFlag||r.reconnect()};n&&(u=n);var o=function(){};if(t&&(o=t),"web"===this.platform)return this.ws=new WebSocket(this.wsUrl),this.ws.onclose=u,this.ws.onopen=i,void(this.ws.onerror=o);var s="uni"===this.platform?uni:wx;this.ws=s.connectSocket({url:this.wsUrl,complete:function(){}}),this.ws.onClose(u),this.ws.onOpen(i),this.ws.onError(o)},s.reconnect=function(){var e=this;this.lock||(this.lock=!0,setTimeout(function(){e.createWs(),e.lock=!1},2e3))},o}(r),e.emitter=r,e.uuid=u});
//# sourceMappingURL=index.umd.js.map
