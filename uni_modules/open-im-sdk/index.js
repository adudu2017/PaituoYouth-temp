var e,n,t=function(){function e(){this.events=void 0,this.events={}}var n=e.prototype;return n.emit=function(e,n){return this.events[e]&&this.events[e].forEach(function(e){return e(n)}),this},n.on=function(e,n){return this.events[e]?this.events[e].push(n):this.events[e]=[n],this},n.off=function(e,n){if(e&&"function"==typeof n){var t=this.events[e],r=t.findIndex(function(e){return e===n});t.splice(r,1)}else this.events[e]=[];return this},e}();function r(e,n){return r=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e},r(e,n)}exports.RequestFunc=void 0,(e=exports.RequestFunc||(exports.RequestFunc={})).INITSDK="InitSDK",e.LOGIN="Login",e.LOGOUT="Logout",e.GETLOGINSTATUS="GetLoginStatus",e.GETLOGINUSER="GetLoginUser",e.GETSELFUSERINFO="GetSelfUserInfo",e.CREATETEXTMESSAGE="CreateTextMessage",e.CREATETEXTATMESSAGE="CreateTextAtMessage",e.CREATEIMAGEMESSAGEFROMBYURL="CreateImageMessageByURL",e.CREATESOUNDMESSAGEBYURL="CreateSoundMessageByURL",e.CREATEVIDEOMESSAGEBYURL="CreateVideoMessageByURL",e.CREATEFILEMESSAGEBYURL="CreateFileMessageByURL",e.CREATELOCATIONMESSAGE="CreateLocationMessage",e.CREATECUSTOMMESSAGE="CreateCustomMessage",e.CREATEMERGERMESSAGE="CreateMergerMessage",e.CREATEFORWARDMESSAGE="CreateForwardMessage",e.CREATEQUOTEMESSAGE="CreateQuoteMessage",e.CREATECARDMESSAGE="CreateCardMessage",e.SENDMESSAGE="SendMessage",e.SENDMESSAGENOTOSS="SendMessageNotOss",e.GETHISTORYMESSAGELIST="GetHistoryMessageList",e.REVOKEMESSAGE="RevokeMessage",e.DELETEMESSAGEFROMLOCALSTORAGE="DeleteMessageFromLocalStorage",e.MARKSINGLEMESSAGEHASREAD="MarkSingleMessageHasRead",e.INSERTSINGLEMESSAGETOLOCALSTORAGE="InsertSingleMessageToLocalStorage",e.INSERTGROUPMESSAGETOLOCALSTORAGE="InsertGroupMessageToLocalStorage",e.TYPINGSTATUSUPDATE="TypingStatusUpdate",e.MARKC2CMESSAGEASREAD="MarkC2CMessageAsRead",e.CLEARC2CHISTORYMESSAGE="ClearC2CHistoryMessage",e.CLEARGROUPHISTORYMESSAGE="ClearGroupHistoryMessage",e.ADDFRIEND="AddFriend",e.GETDESIGNATEDFRIENDSINFO="GetDesignatedFriendsInfo",e.GETRECVFRIENDAPPLICATIONLIST="GetRecvFriendApplicationList",e.GETSENDFRIENDAPPLICATIONLIST="GetSendFriendApplicationList",e.GETFRIENDLIST="GetFriendList",e.SETFRIENDREMARK="SetFriendRemark",e.ADDBLACK="AddBlack",e.GETBLACKLIST="GetBlackList",e.REMOVEBLACK="RemoveBlack",e.CHECKFRIEND="CheckFriend",e.ACCEPTFRIENDAPPLICATION="AcceptFriendApplication",e.REFUSEFRIENDAPPLICATION="RefuseFriendApplication",e.DELETEFRIEND="DeleteFriend",e.GETUSERSINFO="GetUsersInfo",e.SETSELFINFO="SetSelfInfo",e.GETALLCONVERSATIONLIST="GetAllConversationList",e.GETCONVERSATIONLISTSPLIT="GetConversationListSplit",e.GETONECONVERSATION="GetOneConversation",e.GETCONVERSATIONIDBYSESSIONTYPE="GetConversationIDBySessionType",e.GETMULTIPLECONVERSATION="GetMultipleConversation",e.DELETECONVERSATION="DeleteConversation",e.SETCONVERSATIONDRAFT="SetConversationDraft",e.PINCONVERSATION="PinConversation",e.GETTOTALUNREADMSGCOUNT="GetTotalUnreadMsgCount",e.GETCONVERSATIONRECVMESSAGEOPT="GetConversationRecvMessageOpt",e.SETCONVERSATIONRECVMESSAGEOPT="SetConversationRecvMessageOpt",e.SEARCHLOCALMESSAGES="SearchLocalMessages",e.MARKGROUPMESSAGEHASREAD="MarkGroupMessageHasRead",e.INVITEUSERTOGROUP="InviteUserToGroup",e.KICKGROUPMEMBER="KickGroupMember",e.GETGROUPMEMBERSINFO="GetGroupMembersInfo",e.GETGROUPMEMBERLIST="GetGroupMemberList",e.GETJOINEDGROUPLIST="GetJoinedGroupList",e.CREATEGROUP="CreateGroup",e.SETGROUPINFO="SetGroupInfo",e.GETGROUPSINFO="GetGroupsInfo",e.JOINGROUP="JoinGroup",e.QUITGROUP="QuitGroup",e.TRANSFERGROUPOWNER="TransferGroupOwner",e.GETSENDGROUPAPPLICATIONLIST="GetSendGroupApplicationList",e.GETRECVGROUPAPPLICATIONLIST="GetRecvGroupApplicationList",e.ACCEPTGROUPAPPLICATION="AcceptGroupApplication",e.REFUSEGROUPAPPLICATION="RefuseGroupApplication",exports.CbEvents=void 0,(n=exports.CbEvents||(exports.CbEvents={})).ONCONNECTFAILED="OnConnectFailed",n.ONCONNECTSUCCESS="OnConnectSuccess",n.ONCONNECTING="OnConnecting",n.ONKICKEDOFFLINE="OnKickedOffline",n.ONSELFINFOUPDATED="OnSelfInfoUpdated",n.ONUSERTOKENEXPIRED="OnUserTokenExpired",n.SENDMSGPROGRESS="OnProgress",n.ONRECVNEWMESSAGE="OnRecvNewMessage",n.ONRECVMESSAGEREVOKED="OnRecvMessageRevoked",n.ONRECVC2CREADRECEIPT="OnRecvC2CReadReceipt",n.ONCONVERSATIONCHANGED="OnConversationChanged",n.ONNEWCONVERSATION="OnNewConversation",n.ONSYNCSERVERFAILED="OnSyncServerFailed",n.ONSYNCSERVERFINISH="OnSyncServerFinish",n.ONSYNCSERVERSTART="OnSyncServerStart",n.ONTOTALUNREADMESSAGECOUNTCHANGED="OnTotalUnreadMessageCountChanged",n.ONBLACKADDED="OnBlackAdded",n.ONBLACKDELETED="OnBlackDeleted",n.ONFRIENDAPPLICATIONACCEPTED="OnFriendApplicationAccepted",n.ONFRIENDAPPLICATIONADDED="OnFriendApplicationAdded",n.ONRECEIVEFRIENDAPPLICATIONADDED="OnReceiveFriendApplicationAdded",n.ONRECEIVEFRIENDAPPLICATIONDELETED="OnReceiveFriendApplicationDeleted",n.ONFRIENDAPPLICATIONDELETED="OnFriendApplicationDeleted",n.ONFRIENDAPPLICATIONREJECTED="OnFriendApplicationRejected",n.ONFRIENDINFOCHANGED="OnFriendInfoChanged",n.ONFRIENDADDED="OnFriendAdded",n.ONFRIENDDELETED="OnFriendDeleted",n.ONJOINEDGROUPADDED="OnJoinedGroupAdded",n.ONJOINEDGROUPDELETED="OnJoinedGroupDeleted",n.ONGROUPMEMBERADDED="OnGroupMemberAdded",n.ONGROUPMEMBERDELETED="OnGroupMemberDeleted",n.ONRECEIVEJOINGROUPAPPLICATIONADDED="OnReceiveJoinGroupApplicationAdded",n.ONRECEIVEJOINGROUPAPPLICATIONDELETED="OnReceiveJoinGroupApplicationDeleted",n.ONGROUPAPPLICATIONADDED="OnGroupApplicationAdded",n.ONGROUPAPPLICATIONDELETED="OnGroupApplicationDeleted",n.ONGROUPINFOCHANGED="OnGroupInfoChanged",n.ONGROUPMEMBERINFOCHANGED="OnGroupMemberInfoChanged",n.ONGROUPAPPLICATIONACCEPTED="OnGroupApplicationAccepted",n.ONGROUPAPPLICATIONREJECTED="OnGroupApplicationRejected";var o=function(e){return(36*Math.random()).toString(36).slice(2)+(new Date).getTime().toString()+e};exports.OpenIMSDK=function(e){var n,t;function i(){var n;return(n=e.call(this)||this).ws=void 0,n.uid=void 0,n.token=void 0,n.platform="web",n.wsUrl="",n.lock=!1,n.logoutFlag=!1,n.timer=void 0,n.ws2promise={},n.onceFlag=!0,n.getLoginStatus=function(e){return new Promise(function(t,r){var i=e||o(n.uid),u={reqFuncName:exports.RequestFunc.GETLOGINSTATUS,operationID:i,userID:n.uid,data:""};n.wsSend(u,t,r)})},n.getLoginUser=function(e){return new Promise(function(t,r){var i=e||o(n.uid),u={reqFuncName:exports.RequestFunc.GETLOGINUSER,operationID:i,userID:n.uid,data:""};n.wsSend(u,t,r)})},n.getSelfUserInfo=function(e){return new Promise(function(t,r){var i=e||o(n.uid),u={reqFuncName:exports.RequestFunc.GETSELFUSERINFO,operationID:i,userID:n.uid,data:""};n.wsSend(u,t,r)})},n.getUsersInfo=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.GETUSERSINFO,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.setSelfInfo=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.SETSELFINFO,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.createTextMessage=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.CREATETEXTMESSAGE,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.createTextAtMessage=function(e,t){return new Promise(function(r,i){var u=e;u.atUserIDList=JSON.stringify(u.atUserIDList);var s=t||o(n.uid),a={reqFuncName:exports.RequestFunc.CREATETEXTATMESSAGE,operationID:s,userID:n.uid,data:u};n.wsSend(a,r,i)})},n.createImageMessage=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s=e;s.bigPicture=JSON.stringify(s.bigPicture),s.snapshotPicture=JSON.stringify(s.snapshotPicture),s.sourcePicture=JSON.stringify(s.sourcePicture);var a={reqFuncName:exports.RequestFunc.CREATEIMAGEMESSAGEFROMBYURL,operationID:u,userID:n.uid,data:JSON.stringify(s)};n.wsSend(a,r,i)})},n.createSoundMessage=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={soundBaseInfo:JSON.stringify(e)},a={reqFuncName:exports.RequestFunc.CREATESOUNDMESSAGEBYURL,operationID:u,userID:n.uid,data:JSON.stringify(s)};n.wsSend(a,r,i)})},n.createVideoMessage=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={videoBaseInfo:JSON.stringify(e)},a={reqFuncName:exports.RequestFunc.CREATEVIDEOMESSAGEBYURL,operationID:u,userID:n.uid,data:JSON.stringify(s)};n.wsSend(a,r,i)})},n.createFileMessage=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={fileBaseInfo:JSON.stringify(e)},a={reqFuncName:exports.RequestFunc.CREATEFILEMESSAGEBYURL,operationID:u,userID:n.uid,data:JSON.stringify(s)};n.wsSend(a,r,i)})},n.createMergerMessage=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s=e;s.messageList=JSON.stringify(e.messageList),s.summaryList=JSON.stringify(e.summaryList);var a={reqFuncName:exports.RequestFunc.CREATEMERGERMESSAGE,operationID:u,userID:n.uid,data:s};n.wsSend(a,r,i)})},n.createForwardMessage=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.CREATEFORWARDMESSAGE,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.createLocationMessage=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.CREATELOCATIONMESSAGE,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.createCustomMessage=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.CREATECUSTOMMESSAGE,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.createQuoteMessage=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.CREATEQUOTEMESSAGE,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.createCardMessage=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.CREATECARDMESSAGE,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.sendMessage=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s=e;s.offlinePushInfo=s.offlinePushInfo?JSON.stringify(e.offlinePushInfo):"";var a={reqFuncName:exports.RequestFunc.SENDMESSAGE,operationID:u,userID:n.uid,data:s};n.wsSend(a,r,i)})},n.sendMessageNotOss=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s=e;s.offlinePushInfo=s.offlinePushInfo?JSON.stringify(e.offlinePushInfo):"";var a={reqFuncName:exports.RequestFunc.SENDMESSAGENOTOSS,operationID:u,userID:n.uid,data:s};n.wsSend(a,r,i)})},n.getHistoryMessageList=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.GETHISTORYMESSAGELIST,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.revokeMessage=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.REVOKEMESSAGE,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.deleteMessageFromLocalStorage=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.DELETEMESSAGEFROMLOCALSTORAGE,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.markSingleMessageHasRead=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.MARKSINGLEMESSAGEHASREAD,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.markGroupMessageHasRead=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.MARKGROUPMESSAGEHASREAD,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.insertSingleMessageToLocalStorage=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.INSERTSINGLEMESSAGETOLOCALSTORAGE,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.insertGroupMessageToLocalStorage=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.INSERTGROUPMESSAGETOLOCALSTORAGE,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.typingStatusUpdate=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.TYPINGSTATUSUPDATE,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.markC2CMessageAsRead=function(e,t){return new Promise(function(r,i){var u=e;u.msgIDList=JSON.stringify(u.msgIDList);var s=t||o(n.uid),a={reqFuncName:exports.RequestFunc.MARKC2CMESSAGEASREAD,operationID:s,userID:n.uid,data:u};n.wsSend(a,r,i)})},n.clearC2CHistoryMessage=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.CLEARC2CHISTORYMESSAGE,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.clearGroupHistoryMessage=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.CLEARGROUPHISTORYMESSAGE,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.getAllConversationList=function(e){return new Promise(function(t,r){var i=e||o(n.uid),u={reqFuncName:exports.RequestFunc.GETALLCONVERSATIONLIST,operationID:i,userID:n.uid,data:""};n.wsSend(u,t,r)})},n.getConversationListSplit=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.GETCONVERSATIONLISTSPLIT,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.getOneConversation=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.GETONECONVERSATION,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.getConversationIDBySessionType=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.GETCONVERSATIONIDBYSESSIONTYPE,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.getMultipleConversation=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.GETMULTIPLECONVERSATION,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.deleteConversation=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.DELETECONVERSATION,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.setConversationDraft=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.SETCONVERSATIONDRAFT,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.pinConversation=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.PINCONVERSATION,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.getTotalUnreadMsgCount=function(e){return new Promise(function(t,r){var i=e||o(n.uid),u={reqFuncName:exports.RequestFunc.GETTOTALUNREADMSGCOUNT,operationID:i,userID:n.uid,data:""};n.wsSend(u,t,r)})},n.getConversationRecvMessageOpt=function(e,t){return new Promise(function(e,r){var i=t||o(n.uid),u={reqFuncName:exports.RequestFunc.GETCONVERSATIONRECVMESSAGEOPT,operationID:i,userID:n.uid,data:""};n.wsSend(u,e,r)})},n.setConversationRecvMessageOpt=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s=e;s.conversationIDList=JSON.stringify(e.conversationIDList);var a={reqFuncName:exports.RequestFunc.SETCONVERSATIONRECVMESSAGEOPT,operationID:u,userID:n.uid,data:s};n.wsSend(a,r,i)})},n.searchLocalMessages=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.SEARCHLOCALMESSAGES,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.addFriend=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.ADDFRIEND,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.getDesignatedFriendsInfo=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.GETDESIGNATEDFRIENDSINFO,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.getRecvFriendApplicationList=function(e){return new Promise(function(t,r){var i=e||o(n.uid),u={reqFuncName:exports.RequestFunc.GETRECVFRIENDAPPLICATIONLIST,operationID:i,userID:n.uid,data:""};n.wsSend(u,t,r)})},n.getSendFriendApplicationList=function(e){return new Promise(function(t,r){var i=e||o(n.uid),u={reqFuncName:exports.RequestFunc.GETSENDFRIENDAPPLICATIONLIST,operationID:i,userID:n.uid,data:""};n.wsSend(u,t,r)})},n.getFriendList=function(e){return new Promise(function(t,r){var i=e||o(n.uid),u={reqFuncName:exports.RequestFunc.GETFRIENDLIST,operationID:i,userID:n.uid,data:""};n.wsSend(u,t,r)})},n.setFriendRemark=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.SETFRIENDREMARK,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.checkFriend=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.CHECKFRIEND,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.acceptFriendApplication=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.ACCEPTFRIENDAPPLICATION,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.refuseFriendApplication=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.REFUSEFRIENDAPPLICATION,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.deleteFriend=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.DELETEFRIEND,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.addBlack=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.ADDBLACK,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.removeBlack=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.REMOVEBLACK,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.getBlackList=function(e){return new Promise(function(t,r){var i=e||o(n.uid),u={reqFuncName:exports.RequestFunc.GETBLACKLIST,operationID:i,userID:n.uid,data:""};n.wsSend(u,t,r)})},n.inviteUserToGroup=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s=e;s.userIDList=JSON.stringify(s.userIDList);var a={reqFuncName:exports.RequestFunc.INVITEUSERTOGROUP,operationID:u,userID:n.uid,data:s};n.wsSend(a,r,i)})},n.kickGroupMember=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s=e;s.userIDList=JSON.stringify(s.userIDList);var a={reqFuncName:exports.RequestFunc.KICKGROUPMEMBER,operationID:u,userID:n.uid,data:s};n.wsSend(a,r,i)})},n.getGroupMembersInfo=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s=e;s.userIDList=JSON.stringify(s.userIDList);var a={reqFuncName:exports.RequestFunc.GETGROUPMEMBERSINFO,operationID:u,userID:n.uid,data:s};n.wsSend(a,r,i)})},n.getGroupMemberList=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.GETGROUPMEMBERLIST,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.getJoinedGroupList=function(e){return new Promise(function(t,r){var i=e||o(n.uid),u={reqFuncName:exports.RequestFunc.GETJOINEDGROUPLIST,operationID:i,userID:n.uid,data:""};n.wsSend(u,t,r)})},n.createGroup=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s=e;s.groupBaseInfo=JSON.stringify(s.groupBaseInfo),s.memberList=JSON.stringify(s.memberList);var a={reqFuncName:exports.RequestFunc.CREATEGROUP,operationID:u,userID:n.uid,data:s};n.wsSend(a,r,i)})},n.setGroupInfo=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s=e;s.groupInfo=JSON.stringify(s.groupInfo);var a={reqFuncName:exports.RequestFunc.SETGROUPINFO,operationID:u,userID:n.uid,data:s};n.wsSend(a,r,i)})},n.getGroupsInfo=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.GETGROUPSINFO,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.joinGroup=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.JOINGROUP,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.quitGroup=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.QUITGROUP,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.transferGroupOwner=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.TRANSFERGROUPOWNER,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.getSendGroupApplicationList=function(e){return new Promise(function(t,r){var i=e||o(n.uid),u={reqFuncName:exports.RequestFunc.GETSENDGROUPAPPLICATIONLIST,operationID:i,userID:n.uid,data:""};n.wsSend(u,t,r)})},n.getRecvGroupApplicationList=function(e){return new Promise(function(t,r){var i=e||o(n.uid),u={reqFuncName:exports.RequestFunc.GETRECVGROUPAPPLICATIONLIST,operationID:i,userID:n.uid,data:""};n.wsSend(u,t,r)})},n.acceptGroupApplication=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.ACCEPTGROUPAPPLICATION,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.refuseGroupApplication=function(e,t){return new Promise(function(r,i){var u=t||o(n.uid),s={reqFuncName:exports.RequestFunc.REFUSEGROUPAPPLICATION,operationID:u,userID:n.uid,data:e};n.wsSend(s,r,i)})},n.wsSend=function(e,t,r){void 0===n.ws&&r({event:e.reqFuncName,errCode:112,errMsg:"ws conect failed...",data:"",operationID:e.operationID||""}),"object"==typeof e.data&&(e.data=JSON.stringify(e.data));var i={oid:e.operationID||o(n.uid),mname:e.reqFuncName,mrsve:t,mrjet:r,flag:!1};n.ws2promise[i.oid]=i;var u=function(t){var r=JSON.parse(t.data);exports.CbEvents[r.event.toUpperCase()]&&n.emit(r.event,r),e.reqFuncName===exports.RequestFunc.LOGOUT&&(n.logoutFlag=!0,n.ws.close(),n.ws=void 0);var o=n.ws2promise[r.operationID];o&&(0===r.errCode?o.mrsve(r):o.mrjet(r),delete n.ws2promise[r.operationID])};"web"==n.platform?(n.ws.send(JSON.stringify(e)),n.onceFlag&&(n.ws.onmessage=u,n.onceFlag=!1)):(n.ws.send({data:JSON.stringify(e),success:function(e){"uni"===n.platform&&void 0!==n.ws._callbacks&&void 0!==n.ws._callbacks.message&&(n.ws._callbacks.message=[])}}),n.onceFlag&&(n.ws.onMessage(u),n.onceFlag=!1)),e.reqFuncName===exports.RequestFunc.LOGOUT&&(n.onceFlag=!0)},n.getPlatform(),n}t=e,(n=i).prototype=Object.create(t.prototype),n.prototype.constructor=n,r(n,t);var u=i.prototype;return u.login=function(e){var n=this;return new Promise(function(t,r){var o=e.userID,i=e.token,u=e.operationID;n.wsUrl=e.url+"?sendID="+o+"&token="+i+"&platformID="+e.platformID;var s={userID:o,token:i},a={event:exports.RequestFunc.LOGIN,errCode:0,errMsg:"",data:"",operationID:u||""};n.createWs(function(){n.uid=o,n.token=i,n.iLogin(s,u).then(function(e){n.logoutFlag=!1,t(e)}).catch(function(e){a.errCode=e.errCode,a.errMsg=e.errMsg,r(a)})},function(){},function(e){console.log(e),a.errCode=111,a.errMsg="ws connect failed...",n.logoutFlag||n.reconnect(),r(a)}),n.ws||(a.errCode=112,a.errMsg="The current platform is not supported...",r(a))})},u.iLogin=function(e,n){var t=this;return new Promise(function(r,i){var u=n||o(t.uid),s={reqFuncName:exports.RequestFunc.LOGIN,operationID:u,userID:t.uid,data:e};t.wsSend(s,r,i)})},u.logout=function(e){var n=this;return new Promise(function(t,r){var i=e||o(n.uid),u={reqFuncName:exports.RequestFunc.LOGOUT,operationID:i,userID:n.uid,data:""};n.wsSend(u,t,r)})},u.getPlatform=function(){var e=typeof WebSocket,n=typeof uni,t=typeof wx;this.platform="undefined"===e?"object"===n&&"object"!==t?"uni":"object"!==n&&"object"===t?"wx":"unknow":"web"},u.createWs=function(e,n,t){var r=this,o=function(){r.iLogin({userID:r.uid,token:r.token}).then(function(e){return r.logoutFlag=!1})};e&&(o=e);var i=function(){console.log("ws close agin:::"),r.logoutFlag||r.reconnect()};n&&(i=n);var u=function(){};if(t&&(u=t),"web"===this.platform)return this.ws=new WebSocket(this.wsUrl),this.ws.onclose=i,this.ws.onopen=o,void(this.ws.onerror=u);var s="uni"===this.platform?uni:wx;this.ws=s.connectSocket({url:this.wsUrl,complete:function(){}}),this.ws.onClose(i),this.ws.onOpen(o),this.ws.onError(u)},u.reconnect=function(){var e=this;this.lock||(this.lock=!0,setTimeout(function(){e.createWs(),e.lock=!1},2e3))},i}(t),exports.emitter=t,exports.uuid=o;
//# sourceMappingURL=index.js.map
